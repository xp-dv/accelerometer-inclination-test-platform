<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Accelerometer Inclination Test Platform: State Handlers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Accelerometer Inclination Test Platform
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('group___state_handler.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">State Handlers</div></div>
</div><!--header-->
<div class="contents">

<p>Functions for testing the system components such as servos, sensors, etc.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gae946d792482c6d01585a939095493562" id="r_gae946d792482c6d01585a939095493562"><td class="memItemLeft" align="right" valign="top"><a class="el" href="main_8c.html#aeaac97ef8a153a4e1abc636f535656eb">system_state_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gae946d792482c6d01585a939095493562">startup_state_handler</a> (void)</td></tr>
<tr class="memdesc:gae946d792482c6d01585a939095493562"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles the startup of the system, initializing hardware peripherals and configuring settings.  <br /></td></tr>
<tr class="separator:gae946d792482c6d01585a939095493562"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae33a7f1a2bf51bf958eb9fad6b479b0f" id="r_gae33a7f1a2bf51bf958eb9fad6b479b0f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="main_8c.html#aeaac97ef8a153a4e1abc636f535656eb">system_state_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gae33a7f1a2bf51bf958eb9fad6b479b0f">home_state_handler</a> (void)</td></tr>
<tr class="memdesc:gae33a7f1a2bf51bf958eb9fad6b479b0f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Home position state intended to reset the position of the device upon reset.  <br /></td></tr>
<tr class="separator:gae33a7f1a2bf51bf958eb9fad6b479b0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaddf76a33aedcef21a76b5fa3d1253c42" id="r_gaddf76a33aedcef21a76b5fa3d1253c42"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gaddf76a33aedcef21a76b5fa3d1253c42">idle_state_handler</a> (void)</td></tr>
<tr class="memdesc:gaddf76a33aedcef21a76b5fa3d1253c42"><td class="mdescLeft">&#160;</td><td class="mdescRight">This handler function is called for every character captured by the UART Rx interrupt.  <br /></td></tr>
<tr class="separator:gaddf76a33aedcef21a76b5fa3d1253c42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1bad73fad37a1d742517b38e92ecde53" id="r_ga1bad73fad37a1d742517b38e92ecde53"><td class="memItemLeft" align="right" valign="top"><a class="el" href="main_8c.html#aeaac97ef8a153a4e1abc636f535656eb">system_state_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga1bad73fad37a1d742517b38e92ecde53">run_setpoint_state_handler</a> (void)</td></tr>
<tr class="memdesc:ga1bad73fad37a1d742517b38e92ecde53"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles the running of a setpoint.  <br /></td></tr>
<tr class="separator:ga1bad73fad37a1d742517b38e92ecde53"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3b613d30c36b4e1a4302d5868b7bcc66" id="r_ga3b613d30c36b4e1a4302d5868b7bcc66"><td class="memItemLeft" align="right" valign="top"><a class="el" href="main_8c.html#aeaac97ef8a153a4e1abc636f535656eb">system_state_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga3b613d30c36b4e1a4302d5868b7bcc66">run_profile_state_handler</a> (void)</td></tr>
<tr class="memdesc:ga3b613d30c36b4e1a4302d5868b7bcc66"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles the running of a profile by iterating through setpoints.  <br /></td></tr>
<tr class="separator:ga3b613d30c36b4e1a4302d5868b7bcc66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga544eac4113c6f21e8cb616bce48d317f" id="r_ga544eac4113c6f21e8cb616bce48d317f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="main_8c.html#aeaac97ef8a153a4e1abc636f535656eb">system_state_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga544eac4113c6f21e8cb616bce48d317f">run_test_state_handler</a> (void)</td></tr>
<tr class="memdesc:ga544eac4113c6f21e8cb616bce48d317f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles the running for running a test on the servo.  <br /></td></tr>
<tr class="separator:ga544eac4113c6f21e8cb616bce48d317f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Functions for testing the system components such as servos, sensors, etc. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="gae33a7f1a2bf51bf958eb9fad6b479b0f" name="gae33a7f1a2bf51bf958eb9fad6b479b0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae33a7f1a2bf51bf958eb9fad6b479b0f">&#9670;&#160;</a></span>home_state_handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="main_8c.html#aeaac97ef8a153a4e1abc636f535656eb">system_state_t</a> home_state_handler </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Home position state intended to reset the position of the device upon reset. </p>
<p>It is required for <a class="el" href="group___movement_commands.html#ga56392c38514aa5c4a85ab57f1ca90fba" title="Cancels the current operation and transitions the device to the home state.">cancel()</a> to function properly.</p>
<dl class="section return"><dt>Returns</dt><dd>system_state_t </dd></dl>

</div>
</div>
<a id="gaddf76a33aedcef21a76b5fa3d1253c42" name="gaddf76a33aedcef21a76b5fa3d1253c42"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaddf76a33aedcef21a76b5fa3d1253c42">&#9670;&#160;</a></span>idle_state_handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void idle_state_handler </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This handler function is called for every character captured by the UART Rx interrupt. </p>
<p>This allows for execution of the <a class="el" href="group___movement_commands.html#gae9d98de81e95024d58ca3c6fa4256470" title="Stops all active platform operations and transitions to the idle state.">stop()</a> and <a class="el" href="group___movement_commands.html#ga56392c38514aa5c4a85ab57f1ca90fba" title="Cancels the current operation and transitions the device to the home state.">cancel()</a> commands at any time or the execution of setpoint commands while the device is in the IDLE_STATE.</p>
<p>In the idle state, the system waits for a UART instruction to be received. Once the instruction is received and parsed, it is executed based on the command. The handler supports a wide range of instructions, including movement, stop, cancel, and testing commands. It also handles argument validation and echoes the status of the executed instruction back via UART.</p>
<p>The instructions handled by this handler include:</p><ul>
<li>MOVE_INSTRUCTION: Moves the system with specified arguments.</li>
<li>STOP_INSTRUCTION: Stops the system's current operation (system reboot needed to resume operations)</li>
<li>CANCEL_INSTRUCTION: Cancels the current operation.</li>
<li>RUN_SETPOINT_INSTRUCTION: Runs a specified setpoint.</li>
<li>RUN_PROFILE_INSTRUCTION: Runs a profile of setpoints.</li>
<li>GET_SETPOINT_INSTRUCTION: Retrieves a setpoint.</li>
<li>ADD_SETPOINT_INSTRUCTION: Adds a new setpoint.</li>
<li>REMOVE_SETPOINT_INSTRUCTION: Removes an existing setpoint.</li>
<li>GET_PROFILE_INSTRUCTION: Retrieves a profile.</li>
<li>CLEAR_PROFILE_INSTRUCTION: Clears a profile from memory.</li>
<li>TEST_SERVOS_INSTRUCTION: Tests the servo motors.</li>
<li>TEST_ADXL_INSTRUCTION: Tests the accelerometer (ADXL).</li>
<li>TEST_FLASH_INSTRUCTION: Tests the flash memory.</li>
<li>TEST_LED_INSTRUCTION: Toggles an LED for testing.</li>
<li>TEST_ECHO_INSTRUCTION: Echoes the received instruction back.</li>
</ul>
<p>Each instruction is validated for the correct number of arguments, and the corresponding action is performed. If an invalid instruction or incorrect argument count is encountered, an error status is echoed back.</p>
<dl class="section return"><dt>Returns</dt><dd>None </dd></dl>

</div>
</div>
<a id="ga3b613d30c36b4e1a4302d5868b7bcc66" name="ga3b613d30c36b4e1a4302d5868b7bcc66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3b613d30c36b4e1a4302d5868b7bcc66">&#9670;&#160;</a></span>run_profile_state_handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="main_8c.html#aeaac97ef8a153a4e1abc636f535656eb">system_state_t</a> run_profile_state_handler </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles the running of a profile by iterating through setpoints. </p>
<p>This handler processes the current setpoint from a specified profile and moves the system towards the target setpoint values. The setpoint data is retrieved from flash memory, and the system adjusts the pulse width values (<code>CCR_X</code> and <code>CCR_Y</code>) to match the setpoint's <code>x</code> and <code>y</code> values. The movement speed is determined by the <code><a class="el" href="structsetpoint.html#a0cd38ac3cde531175b412288c6cd2dbc">setpoint.speed</a></code> value. Once a setpoint is reached, the function waits (via PROFILE_WAIT) and proceeds to the next setpoint in the profile.</p>
<p>If the requested setpoint contains invalid data (indicated by <code>FLASH_EMPTY</code> values), the function returns to the idle state.</p>
<p>The function continues running through the profile until all setpoints are processed, at which point the state transitions to <code>IDLE_STATE</code>.</p>
<dl class="section return"><dt>Returns</dt><dd>The current state, which can be <code>RUN_PROFILE_STATE</code> if there are more setpoints to process, or <code>IDLE_STATE</code> when the profile has been fully processed or if no valid setpoints are found. </dd></dl>

</div>
</div>
<a id="ga1bad73fad37a1d742517b38e92ecde53" name="ga1bad73fad37a1d742517b38e92ecde53"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1bad73fad37a1d742517b38e92ecde53">&#9670;&#160;</a></span>run_setpoint_state_handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="main_8c.html#aeaac97ef8a153a4e1abc636f535656eb">system_state_t</a> run_setpoint_state_handler </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles the running of a setpoint. </p>
<p>This function manages the movement of the system towards a setpoint defined by <code><a class="el" href="structactive__setpoint.html#af5e68ad559102359f2d250ae692d9403">active_setpoint.x</a></code> and <code><a class="el" href="structactive__setpoint.html#a6285e6a5dd4f70ad253f3a7eee8520ee">active_setpoint.y</a></code>. It increments or decrements the pulse width values (<code>CCR_X</code> and <code>CCR_Y</code>) in small steps, determined by the speed specified in <code><a class="el" href="structactive__setpoint.html#a0cd38ac3cde531175b412288c6cd2dbc">active_setpoint.speed</a></code>, until both the <code>CCR_X</code> and <code>CCR_Y</code> values match the target setpoint values.</p>
<p>The speed of the movement is inversely related to the <code><a class="el" href="structactive__setpoint.html#a0cd38ac3cde531175b412288c6cd2dbc">active_setpoint.speed</a></code> value, meaning a higher speed value results in a faster movement, while a lower speed results in slower movement. The system prevents overshooting the setpoint by adjusting the pulse width values to exactly match the target when it gets close enough.</p>
<p>Once both <code>CCR_X</code> and <code>CCR_Y</code> match the target setpoint values, the state transitions to <code>IDLE_STATE</code>. Otherwise, the function continues to increment or decrement the pulse width values in the next cycle.</p>
<dl class="section return"><dt>Returns</dt><dd>The current state, which will be <code>RUN_SETPOINT_STATE</code> while the setpoint is being processed and <code>IDLE_STATE</code> once the setpoint is reached. </dd></dl>

</div>
</div>
<a id="ga544eac4113c6f21e8cb616bce48d317f" name="ga544eac4113c6f21e8cb616bce48d317f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga544eac4113c6f21e8cb616bce48d317f">&#9670;&#160;</a></span>run_test_state_handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="main_8c.html#aeaac97ef8a153a4e1abc636f535656eb">system_state_t</a> run_test_state_handler </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles the running for running a test on the servo. </p>
<p>This handler manages the test state by controlling the movement of the servos towards their target setpoints and updating the system accordingly. It checks whether the setpoint has been reached and moves to the next setpoint if necessary. After completing the movement, it performs additional operations such as testing the accelerometer and retrieving the next setpoint for the profile.</p>
<dl class="section return"><dt>Returns</dt><dd>The current state, which can be <code>IDLE_STATE</code> if there are more setpoints to process, or <code>RUN_TEST_STATE</code> when the profile has been fully processed or if no valid setpoints are found. </dd></dl>

</div>
</div>
<a id="gae946d792482c6d01585a939095493562" name="gae946d792482c6d01585a939095493562"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae946d792482c6d01585a939095493562">&#9670;&#160;</a></span>startup_state_handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="main_8c.html#aeaac97ef8a153a4e1abc636f535656eb">system_state_t</a> startup_state_handler </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles the startup of the system, initializing hardware peripherals and configuring settings. </p>
<p>This function performs the necessary steps to initialize the system's peripherals and set the initial state. The steps include:</p><ul>
<li>Configuring PWM for motors (with specified frequency and pulse width).</li>
<li>Starting the PWM signals for motor control.</li>
<li>Setting initial positions for the motors by calling the <code>move</code> function.</li>
<li>Starting the timer interrupt for servo control.</li>
<li>Initializing the accelerometer for motion sensing.</li>
<li>Configuring the UART to receive data via interrupts.</li>
<li>Transmitting a startup message code over UART to indicate the device is ready.</li>
</ul>
<dl class="section return"><dt>Returns</dt><dd>system_state_t<ul>
<li>IDLE_STATE: The system transitions to the idle state after the startup operations are completed. </li>
</ul>
</dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
